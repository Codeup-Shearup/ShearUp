<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <head th:replace="partials :: head (Title = 'View Barber Profile')">
        <meta charset="UTF-8">
        <title>Barber profile page</title>
            <meta class="map" th:content="${@environment.getProperty('map.api.key')}">
        <!--FONT AWESOME ICONS-->
        <script src="https://kit.fontawesome.com/330785b678.js" crossorigin="anonymous"></script>

    </head>
    <script src='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css' rel='stylesheet' />
</head>
<body>
<!--Added script here, this is for mapbox SDK-->
<script src="https://unpkg.com/@mapbox/mapbox-sdk/umd/mapbox-sdk.min.js"></script>
<style>
    body {
        background-color: #2B333D;
    }

    h1 {
        color: #FEFED3;
    }

    p {
        color: #FEFED3;
    }

    .card {
        background-color: #2B333D;
    }

    .card-text {
        color: #FEFED3;
    }

    .card-body {
        background-color: #2B333D;
    }

    .card-title {
        color: white;
    }

</style>

<header th:replace="partials :: header"></header>
<br>
<div class="container">
    <!--<h1>Barber Profile page of <p th:text="${user.firstName}"></p></h1>-->
    <div class="d-flex d-inline">
        <h1 class="text-center">Welcome, </h1> <h1 class="text-center" th:text="${user.firstName}">!</h1>
    </div>

    <div class="px-4 pt-0 pb-4 bg-dark" th:object="${user.firstName}">
        <div class="media align-items-end profile-header">
            <div class="profile mr-3"><img th:src="@{${'/img/barber.jpg'}}" alt="..." width="196"
                                           class="rounded mb-2 img-thumbnail"><a
                    th:href="@{/profile/edit/{id}(id=${user.id})}" class="btn btn-light btn-sm btn-block">Edit
                profile</a></div>
            <div class="media-body mb-5 text-white">
                <h4>Bio: </h4>
                <p class="mt-0 mb-0" th:text="${user.barberDetail.bio}"></p>
                <h4>Phone Number: </h4>
                <p class="small mb-4" th:text="${user.barberDetail.phone}"><i class="fas fa-at mr-2"></i></p>
                <h4>Hours of Operation: </h4>
                <p class="small mb-4" th:text="${user.barberDetail.hoursOfWork}"><i class="far fa-envelope mr-2"></i>>
                </p>
                <form th:action="@{/barber/edit-barber-details}" th:method="get">
                    <input type="hidden" th:name="editBarberDetailsButton" th:value="${user.barberDetail.id}">
                    <button class="btn btn-primary">Edit Barber Details <i class="fas fa-user-cog"></i></button>
                </form>
            </div>
        </div>
    </div>
    <br>
    <hr>
    <!--<div class="card-deck">-->
    <!--  BIO NOT COMING OUT YET DEBUGGING POPULATES IN BIO IN BARBER DETAIL DATABASE  -->
    <!--    <div class="card border-danger rounded" style=" width: 19rem;">-->
    <!--        <div class="card-body">-->
    <!--            <h1 class="card-title">Bio: </h1><p class="card-text" th:text="${user.barberDetail.bio}"></p>-->
    <!--            <h1 class="card-title">Phone Number: </h1><p class="card-text" th:text="${user.barberDetail.phone}"></p>-->
    <!--            <h1 class="card-title">Hours of Operation: </h1><p class="card-text" th:text="${user.barberDetail.hoursOfWork}"></p>-->
    <!--            <form th:action="@{/barber/edit-barber-details}" th:method="get">-->
    <!--                <input type="hidden" th:name="editBarberDetailsButton" th:value="${user.barberDetail.id}">-->
    <!--                <button class="btn btn-primary">Edit Barber Details</button>-->
    <!--            </form>-->
    <!--        </div>-->
    <!--    </div>-->

    <!--    <div class="card border-danger rounded" style=" width: 19rem;">-->
    <h1 class="card-title">Location of Business: </h1>

    <div class="px-4 pt-0 pb-4 bg-dark" th:object="${user.firstName}">
        <div class="media align-items-end profile-header">
            <!--            <div class="profile mr-3"><img th:src="@{${'/img/profile_placeholder.png'}}" alt="..." width="196" class="rounded mb-2 img-thumbnail"><a th:href="@{/profile/edit/{id}(id=${user.id})}" class="btn btn-light btn-sm btn-block">Edit profile</a></div>-->
            <div class="media-body mb-5 text-white">
                <h5>Address: </h5>
                <p class="mt-0 mb-0">
                <p th:text="${user.barberDetail.location.addressOne}"></p> </p>
                <h5>City: </h5>
                <p class="small mb-4" th:text="${user.barberDetail.location.city}"><i class="fas fa-at mr-2"></i></p>
                <h5>State: </h5>
                <p class="small mb-4" th:text="${user.barberDetail.location.state}"><i class="far fa-envelope mr-2"></i>>
                </p>
                <h5>Zip Code: </h5>
                <p class="small mb-4" th:text="${user.barberDetail.location.zipCode}"><i class="far fa-envelope mr-2"></i>></p>
                <form th:action="@{/barber/edit-barber-location}" th:method="get">
                    <input type="hidden" th:name="editLocationButton" th:value="${user.barberDetail.location.id}">
                    <button class="btn btn-primary">Edit Barber Location</button>
                </form>
            </div>
        </div>
    </div>
    <br>
    <!--        <div class="card-body">-->
    <!--  NOBODY TOUCH THIS IF YOU ARE CONFUSED CALL BRANCE -ERASE LATER  -->
    <!--        <h1 class="card-title">Address Line 1: </h1><p class="card-text" th:text="${user.barberDetail.location.addressOne}"></p>-->
    <!--        <p class="card-text" th:text="${user.barberDetail.location.addressTwo}"></p>-->
    <!--        <h1 class="card-title">City: </h1><p class="card-text" th:text="${user.barberDetail.location.city}"></p>-->
    <!--        <h1 class="card-title">State: </h1><p class="card-text" th:text="${user.barberDetail.location.state}"></p>-->
    <!--        <h1 class="card-title">Zipcode: </h1><p class="card-text" th:text="${user.barberDetail.location.zipCode}"></p>-->
    <!--        <form th:action="@{/barber/edit-barber-location}" th:method="get">-->
    <!--            <input type="hidden" th:name="editLocationButton" th:value="${user.barberDetail.location.id}">-->
    <!--            <button class="btn btn-primary">Edit Barber Location</button>-->
    <!--        </form>-->
    <!--        </div>-->
</div>

</div>


<!--  THROWING ERROR FOR NOW WORKING ON FIX
(I DID NOT WANT TO BREAK APPLICATION) -RAMON  -->
<!--  TH EACH WORKS THE USER IN ${A WAY TO GET AROUND DATABASE}  -->

<h1>
    List of Services
    <small class="text-muted">See below</small>
</h1>

<!--<div class="px-4 pt-0 pb-4 bg-dark" th:object="${user.firstName}">-->
<!--    <div class="media align-items-end profile-header">-->
<!--        &lt;!&ndash;            <div class="profile mr-3"><img th:src="@{${'/img/profile_placeholder.png'}}" alt="..." width="196" class="rounded mb-2 img-thumbnail"><a th:href="@{/profile/edit/{id}(id=${user.id})}" class="btn btn-light btn-sm btn-block">Edit profile</a></div>&ndash;&gt;-->
<!--        <div class="media-body mb-5 text-white">-->
<!--            <div class="card border border-danger rounded" style=" width: 19rem;" th:each="service : ${user.getBarberDetail().getServices()}">-->
<!--            <h5>Title </h5><p class="mt-0 mb-0"><p th:text="${service.title}"></p> </p>-->
<!--                <h5>Description: </h5><p class="small mb-4" th:text="${service.description}"><i class="fas fa-at mr-2"></i></p>-->
<!--                <h5>Duration: </h5><p class="small mb-4" th:text="${service.duration}"><i class="fas fa-at mr-2"></i></p>-->
<!--            <h5>Price: </h5><p class="small mb-4" th:text="${service.price}"><i class="far fa-envelope mr-2"></i></p>-->
<!--            </div>-->
<!--                <form th:action="@{/barber/edit-service}" th:method="get">-->
<!--                    <input type="hidden" th:name="editButton" th:value="${service.id}">-->
<!--                    <button class="btn btn-primary">Edit Service</button>-->
<!--                </form>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->


<div class="card border border-danger rounded" style=" width: 19rem;"
     th:each="service : ${user.getBarberDetail().getServices()}">

    <!--   PICTURE OF SERVICE GOES HERE     -->
    <img class="card-image-top" src="..." alt="">
    <div class="card-body">
        <h5 class="card-title">Title: </h5><p class="card-text" th:text="${service.title}"></p>
        <h5 class="card-title">Description: </h5><p class="card-text" th:text="${service.description}"></p>
        <h5 class="card-title">Duration: </h5><p class="card-text" th:text="${service.duration}"></p>
        <h5 class="card-title">Price: </h5><p class="card-text" th:text="${service.price}"></p>
    </div>
    <div th:each="image :${service.getImages()}">
        <img th:src="${'https://cdn.filestackcontent.com/' + image.getFilestackUrl()}" class="hidden" style="height: 200px"></img>
    </div>

    <!--    <form th:action="@{/barber/service-delete}" th:method="post">-->
    <!--        <input type="hidden" th:name="deleteButton" th:value="${service.id}">-->
    <!--        <button class="btn btn-danger">Delete</button>-->
    <!--    </form>-->


    <form th:action="@{/barber/edit-service}" th:method="get">
        <input type="hidden" th:name="editButton" th:value="${service.id}">
        <button class="btn btn-primary">Edit Service <i class="fas fa-edit"></i></button>
    </form>
</div>
<!--Add a service with a photo attached ---try to span these horizontal -->
<a th:href="@{/barber/add-service}">
    <button class="btn btn-success">Add Service</button>
    <a class="nav-link" th:href="@{/services/create}"><i class="fas fa-camera-retro icon"></i></a>
</a>
<!--<script th:src="@{/js/keys.js}"></script> should this be here instead?-->
<!--   added map-->
<div id='map' style='width: 70%; height: 500px;'></div>
<!--   added three spans below, display is none-->
<span id="map_addr1" style="display: none;" th:text="${location.addressOne}"></span>
<span id="map_city" style="display: none;" th:text="${location.city}"></span>
<span id="map_state" style="display: none;" th:text="${location.state}"></span>
<!--   added the entire script below -->
<script>
    // change the accessToken to yours, use the application.properties to fetch the token
    // mapboxgl.accessToken = '';
    const MAPBOX_KEY = document.querySelector('map.api.key').content; //issue with connecting to page - it does pop up with hardcoded API KEY
    mapboxgl.accessToken = MAPBOX_KEY;
    var mapboxClient = mapboxSdk({ accessToken: mapboxgl.accessToken });
    // Grabbed the three spans and assigned them to vars (spans come from the controller)
    var address = document.getElementById("map_addr1").innerHTML;
    var city = document.getElementById("map_city").innerHTML;
    var state = document.getElementById("map_state").innerHTML;
    // geocoded it (turned it into lat/long)
    mapboxClient.geocoding
        .forwardGeocode({
            query: address + "," + city + "," + state,
            autocomplete: false,
            limit: 1
        })
        // sent it to Mapbox SDK/API
        .send()
        // Take the response from API in form of JS promise
        .then(function(response) {
            // check if response is valid
            if (
                response &&
                response.body &&
                response.body.features &&
                response.body.features.length
            ) {
                // if yes, grab the response (JSON) into a var
                var feature = response.body.features[0];

                // init the map object, pass in params
                var map = new mapboxgl.Map({
                    container: 'map',
                    style: 'mapbox://styles/mapbox/dark-v10',
                    center: feature.center,
                    zoom: 10
                });
                // take the response var (feature) and set the lat and long .setLngLat()
                // then add to map .addTo()
                new mapboxgl.Marker().setLngLat(feature.center).addTo(map);
            }
        });

</script>
</div>

<script src="//static.filestackapi.com/filestack-js/3.x.x/filestack.min.js"></script>
<script type="text/javascript" th:src="@{/js/file.js}" />
</div>

<footer th:replace="partials :: footer"></footer>
</body>
</html>